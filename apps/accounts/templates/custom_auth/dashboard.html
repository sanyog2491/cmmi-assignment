<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    {% load static %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="upload-tab" data-toggle="tab" href="#upload-data" role="tab" aria-controls="upload-data" aria-selected="true">Upload Data</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="query-tab" data-toggle="tab" href="#query-builder" role="tab" aria-controls="query-builder" aria-selected="false">Query Builder</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="users-tab" data-toggle="tab" href="#users" role="tab" aria-controls="users" aria-selected="false">Users</a>
            </li>
            <li class="nav-item ml-auto">
                <a class="nav-link" href="{% url 'account_logout' %}">Logout</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="myTabContent">
            <!-- Upload Data Section -->
            <div class="tab-pane fade show active" id="upload-data" role="tabpanel" aria-labelledby="upload-tab">
                <h2>Upload Data</h2>
                <form id="upload-form" action="/upload/" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <input type="file" name="data_file" class="form-control-file">
                    </div>
                    <button type="submit" class="btn btn-primary">Start Upload</button>
                </form>
                <div id="progress-bar" class="progress">
                    <div class="progress-bar" role="progressbar"></div>
                </div>
            </div>

            <!-- Query Builder Section -->
            <div class="tab-pane fade" id="query-builder" role="tabpanel" aria-labelledby="query-tab">
                <h2>Query Builder</h2>
                <form action="/query/" method="post">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="keyword">Keyword</label>
                            <input type="text" name="keyword" class="form-control" id="keyword">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="industry">Industry</label>
                            <select name="industry" class="form-control" id="industry">
                                <option>Select</option>
                                <!-- Add Options Here -->
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="year">Year Founded</label>
                            <input type="number" name="year" class="form-control" id="year">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="city">City</label>
                            <input type="text" name="city" class="form-control" id="city">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="state">State</label>
                            <input type="text" name="state" class="form-control" id="state">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="country">Country</label>
                            <input type="text" name="country" class="form-control" id="country">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="employees_from">Employees (From)</label>
                            <input type="number" name="employees_from" class="form-control" id="employees_from">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="employees_to">Employees (To)</label>
                            <input type="number" name="employees_to" class="form-control" id="employees_to">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Query Data</button>
                </form>
                <div id="query-results"></div>
            </div>

            <!-- Users Section -->
            <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                <h2>Users</h2>
                <form action="/add-user/" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" name="username" class="form-control" id="username">
                    </div>
                    <button type="submit" class="btn btn-primary">Add User</button>
                </form>
                <div id="user-list">
                    <ul class="list-group">
                        <li class="list-group-item">
                            John Doe - johndoe@gmail.com
                            <span class="badge badge-success">Active</span>
                            <button class="btn btn-danger btn-sm float-right">Remove</button>
                        </li>
                        <!-- Add more users here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- JS for Bootstrap and Progress Bar Handling -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Handle form submission and call the API
        $('#upload-form').on('submit', function (e) {
            e.preventDefault();  // Prevent default form submission

            var formData = new FormData();
            var fileInput = $('#file-input')[0].files[0];
            formData.append('file', fileInput);

            // Show the progress bar
            $('#progress-bar').show();

            $.ajax({
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener('progress', function (e) {
                        if (e.lengthComputable) {
                            var percentComplete = (e.loaded / e.total) * 100;
                            $('#progress-bar .progress-bar').css('width', percentComplete + '%');
                        }
                    }, false);
                    return xhr;
                },
                url: '/api/upload/',  // API endpoint for file upload
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    $('#progress-bar .progress-bar').css('width', '100%');
                    alert(response.message);  // Inform the user of success
                },
                error: function (response) {
                    alert('File upload failed!');
                }
            });
        });
    </script>

</body>
</html>
